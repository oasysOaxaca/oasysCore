!function(a){!function(b){"use strict";var c={name:"Oasys Core",version:"1.0.0"},d={url:"./api/user.json",contentType:"application/json",method:"GET",appName:"default"},e={method:"POST",contentType:"application/x-www-form-urlencoded",transformRequestData:!0},f={guestRequestApi:d,login:e},g={username:"",fullname:"",email:"",name:"",lastname:"",surname:"",sessionId:"",token:"",sessionStart:""};a.value("apiUrl","").value("enviroment","production").value("user",g).constant("coreInfo",c).constant("authenticationConfig",f).value("routeToGo","").run(["$authCore","$application","$rootScope","$location","$routefilter","enviroment",function(a,b,d,e,f,g){console.log("Loading ",c),"develop"!==g?(console.log("oasyscorefilter OK"),a.requestUser().then(function(){b.makeReady()}),d.$on("$locationChangeStart",function(){"/loading"!==e.path()&&(b.isReady()||e.path("loading"),f.run(e.path()))})):console.log("Se ha activado el modo desarrollo para el oasyscorefilter")}])}(angular),a.service("$application",function(){var a=!1,b=[],c=function(){for(var a=b.length-1;a>=0;a--)b[a]()};return{isReady:function(){return a},makeReady:function(){a=!0,c()},registerListener:function(c){a?c():b.push(c)}}}),a.service("$authCore",["$q","$http","$cookieStore","$urlResolved","apiUrl","authenticationConfig","user","$corefactory",function(a,b,c,d,e,f,g,h){return{requestUser:function(){var d=a.defer();if(void 0===c.get("username")){console.log(" Request Guest user ::",f.guestRequestApi);var e=f.guestRequestApi;b({method:e.method,url:e.url,cache:!0,contentType:e.contentType}).success(function(a){if(console.log("Getting user Guest",a),"OK"===a.transaction){var b=a.object;console.log("USUARIO INVITADO ",a),b&&(c.put("username",b.username),c.put("roles",b.role)),d.resolve(c.get("username"))}else d.reject({message:"!Ups existe un error con el servidor!!"})}).error(function(a){d.reject(a)})}else d.resolve(c.get("username"));return d.promise},getRoles:function(){return c.get("roles")},getToken:function(){return c.get("token")},getSession:function(){return c.get("session")},getUser:function(){return c.get("username")},exists:function(a){return"guest"===a||void 0!==c.get("roles")&&"authenticate"===a&&"guest"!==c.get("roles")},login:function(a,b,d){console.log("Invoke login at Ath "),h.execute(a,b,function(a){if("OK"===a.transaction||"ok"===a.transaction){var b=a.object;null!==b.username?(c.put("username",b.username),g.usernam=b.username):(c.put("username",b.email),g.usernam=b.email),c.put("token",b.accesToken),g.token=b.token,c.put("email",b.email),g.email=b.email,c.put("fullname",b.fullname),g.fullname=b.fullname,c.put("roles",b.roles),g.name=b.name,g.lastname=b.lastname,g.surname=b.surname,g.session=b.session,c.put("session",b.session),d(a)}else a?(console.log("Error 1",a),d(a)):(console.log("Error 2",a),d({message:"Usuario / Contraseña incorrecta"}))},f.login)},logout:function(a,f,g){d.getUrl(a,function(a){b.defaults.headers.common.Authorization="Bearer ",b({method:"POST",url:e+a,cache:!0,contentType:"application/x-www-form-urlencoded",params:f}).success(function(a){g("OK"===a.transaction||"ok"===a.transaction?{transaction:"ok",username:c.get("username")}:{message:"Usuario / Contraseña incorrecta"})}).error(function(a){console.log(a),g({message:"Usuario / Contraseña incorrecta"})})}),c.remove("username"),c.remove("fullname"),c.remove("token"),c.remove("email"),c.remove("session"),c.remove("roles")}}}]),a.service("$corefactory",["$http","$urlResolved","$upload","$log",function(a,b,c,d){var e=function(a,b){if(!b)return console.log(" SIN CODIFICAR"),a;var c,d,f,g,h,i,j,k="";for(c in a)if(d=a[c],d instanceof Array)for(j=0;j<d.length;++j)h=d[j],f=c+"["+j+"]",i={},i[f]=h,k+=e(i)+"&";else if(d instanceof Object)for(g in d)h=d[g],f=c+"["+g+"]",i={},i[f]=h,k+=e(i)+"&";else void 0!==d&&null!==d&&(k+=encodeURIComponent(c)+"="+encodeURIComponent(d)+"&");return k.length?k.substr(0,k.length-1):k},f=function(c,f,g,h){var i=!1;void 0===h||null===h?h={method:"GET",contentType:"application/json",transformRequestData:!1}:(d.debug("Default config :: ",h),(void 0===h.method||null===h.method||0===h.method.lengt)&&(d.debug("Method Default GET For ",c),h.method="GET"),(void 0===h.contentType||null===h.contentType||0===h.contentType.lengt)&&(d.debug("Content - Type Default application/json For ",c),h.contentType="application/json"),void 0!==h.transformRequestData&&null!==h.transformRequestData&&h.transformRequestData&&"application/x-www-form-urlencoded"===h.contentType&&"POST"===h.method?i=!0:void 0!==h.transformRequestData&&null!==h.transformRequestData&&h.transformRequestData&&"application/x-www-form-urlencoded"!==h.contentType&&d.warn("ERROR encode is activate but the content-Type its Wrong please read de framework doc"),"POST"===h.method&&(console.log("POST ::::"),a.defaults.headers.post["Content-Type"]=h.contentType)),b.getUrl(c,function(b){a({method:h.method,url:b,cache:!0,data:e(f,i)}).success(function(a){g(a)}).error(function(a){d.error("Request wrong :: ",a),g({message:"Ups! existe un problema con el servidor "+b})})})},g=function(a,b,c){d.debug("Execute Option GET",a,b),f(a,b,c,{})},h=function(a,b,c){var d={method:"POST",contentType:"application/x-www-form-urlencoded",transformRequestData:!0};f(a,b,c,d)},i=function(a,b,c){var d={method:"POST",contentType:"",transformRequestData:!1};f(a,b,c,d)};return{executePHP:g,executeGET:g,executePostPHP:h,executePost:i,execute:f,excuteWhithFile:function(a,d,e){console.log("excuteWhithFile ",a,d),(void 0===d.file||null===d.file)&&(console.log("especifique el objeto file:{type:'',name:'',file:''}, consulte Manual del Framwork"),e({transaction:"error",message:"Falta estructura de archivo"})),b.getUrl(a,function(b){d.userId="0",null!==b?c.upload({url:b,method:"POST",data:d,file:d.file.file}).progress(function(a){console.log("percent: "+parseInt(100*a.loaded/a.total))}).success(function(a){e(a)}).error(function(){e({transaction:"error",message:"Ups! existe un problema con el servidor "+b})}):e({transaction:"error",message:"CODE :"+a+" IS NOT REGISTERED YET IN API, PLEASE READ THE FRAMEWORK DOC"})})}}}]),a.run(["$routefilter","$authCore","$corefactory",function(a,b,c){a.register("guest",["/main","/logout","/about","/contact"],function(){return b.exists("guest")},"/"),a.register("guest",["/login"],function(){return b.exists("guest")},"login"),c.executePHP("uri:user@v1",{},function(c){if(console.log("Resultado ",c),"OK"===c.transaction){var d=c.object.uris;a.register("authenticate",d,function(){return b.exists("authenticate")},"login")}})}]),a.controller("LoadingController",["$scope","$application","$location",function(a,b,c){b.registerListener(function(){c.path("/")})}]),a.service("$routefilter",["$location",function(a){var b=[],c=function(a){for(var c=b.length-1;c>=0;c--)for(var e=b[c].routers.length-1;e>=0;e--)if(d(b[c].routers[e],a))return b[c]},d=function(a,b){return b instanceof RegExp?b.test(a):b===a};return{canAccess:function(a){var b=c(a);return b.callback()},register:function(a,c,d,e){console.log("Register Routes",c),e=void 0!==typeof e?e:null,b.push({name:a,routers:c,callback:d,redirectUrl:e})},run:function(b){console.log("Ruta a acceder gg:: ",b);var d=c(b);null!==d&&null!==d.redirectUrl&&(d.callback()||a.path(d.redirectUrl))}}}]),a.service("$urlResolved",["$http",function(a){return{getUrl:function(b,c){a({method:"GET",url:"./api/urlRequest.json",cache:!0,contentType:"application/json"}).success(function(a){for(var d=null,e=a.length-1;e>=0;e--)if(a[e].code===b){d=a[e].url;break}c(d)}).error(function(){console.log("GETURL SERVICE UNAVAILABLE")})}}}])}(angular.module("oasyscore",[]));